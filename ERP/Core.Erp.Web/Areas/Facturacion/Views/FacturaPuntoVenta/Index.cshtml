@model Core.Erp.Info.Facturacion.fa_factura_Info
@{
    ViewBag.Title = "Facturas por Punto de venta";
    if (string.IsNullOrEmpty(Core.Erp.Web.Helps.SessionFixed.IdUsuario) || string.IsNullOrEmpty(Core.Erp.Web.Helps.SessionFixed.IdEmpresa))
    {
        Response.Redirect("~/Account/Login");
    }
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/ValidacionBotonSubmit.js"></script>

@using (Html.BeginForm("Index", "FacturaPuntoVenta", FormMethod.Post, new { @role = "form", @class = "form" }))
{
    @Html.HiddenFor(q => q.IdEmpresa, new { @id = "IdEmpresa" })
    @Html.HiddenFor(q => q.IdCliente, new { @id = "IdCliente" })
    @Html.HiddenFor(q => q.IdTransaccionSession, new { @id = "IdTransaccionSession" })

}

<script type="text/javascript">
    $(function () {
        $("#RegresarFamilia").hide();
        $("#link_factura").click();
        $("#link_cliente").hide();
    });

    function Regresar()
    {
        $("#DivProducto").hide();
        $("#DivFamilia").show();
        $("#RegresarFamilia").hide();
    }

    function AbrirModalCantidad(SecuencialID) {
        $("#SecuenciaModificar").val(SecuencialID);
        var datos = {
            SecuencialID: SecuencialID,
            IdTransaccionSession: $("#IdTransaccionSession").val()
        }
        $.ajax({
            type: 'POST',
            data: JSON.stringify(datos),
            url: '@Url.Action("SetearCantidad", "FacturaPuntoVenta", new { Area = "Facturacion"})',
            async: false,
            bDeferRender: true,
            bProcessing: true,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#CantidadItem").val(data);                
                $("#modal-default-Cantidad").modal('show');
            },
            error: function (error) {
            }
        });
    }

    function EscribirCantidad(Valor) {
        var Cantidad = $("#CantidadItem").val()
        var CantidadString = Cantidad + Valor;
        var CantidadItem = 0;

        if (Number.isNaN(Number.parseFloat(CantidadString))) {
            CantidadItem = 0;
        }
        else {
            CantidadItem = parseFloat(CantidadString)
        }

        $("#CantidadItem").val(CantidadItem);
    }
    
    function Borrar() {
        $("#CantidadItem").val("");
    }

    function ModificarCantidad() {
        var datos = {
            SecuenciaModificar: $("#SecuenciaModificar").val(),
            Cantidad: $("#CantidadItem").val(),
            IdTransaccionSession: $("#IdTransaccionSession").val()
        }
        $.ajax({
            type: 'POST',
            data: JSON.stringify(datos),
            url: '@Url.Action("ModificarCantidad", "FacturaPuntoVenta", new { Area = "Facturacion"})',
            async: false,
            bDeferRender: true,
            bProcessing: true,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#modal-default-Cantidad").modal('hide');
                $("#Subtotal").html(data.subtotal);
                $("#Iva").html(data.iva);
                $("#Total").html(data.total);

                GridViewPartial_Pedido.PerformCallback();
            },
            error: function (error) {
            }
        });
    }

    function EliminarProducto(SecuencialID) {
        if (confirm('¿Estas seguro de eliminar este registro?')) {
            var datos = {
                SecuencialID: SecuencialID,
                IdTransaccionSession: $("#IdTransaccionSession").val()
            }
            $.ajax({
                type: 'POST',
                data: JSON.stringify(datos),
                url: '@Url.Action("EliminarProducto", "FacturaPuntoVenta", new { Area = "Facturacion"})',
                async: false,
                bDeferRender: true,
                bProcessing: true,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    GridViewPartial_Pedido.PerformCallback();
                },
                error: function (error) {
                }
            });
        }
    }
    function VerProductos(SecuencialID)
    {
        var IdEmpresa = SecuencialID.substring(0, 4);
        var IdMarca = SecuencialID.substring(4, 8);

        var datos = {
            SecuencialID: SecuencialID,
            IdTransaccionSession: $("#IdTransaccionSession").val()
        }
        $.ajax({
            type: 'POST',
            data: JSON.stringify(datos),
            url: '@Url.Action("VerProductos", "FacturaPuntoVenta", new { Area = "Facturacion"})',
            async: false,
            bDeferRender: true,
            bProcessing: true,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#DivFamilia").hide();
                $("#DivProducto").show();
                $("#RegresarFamilia").show();


                GridViewPartial_Producto.PerformCallback();
            },
            error: function (error) {
            }
        });
    }

    function AgregarPedido(SecuencialID) {
        var IdEmpresa = SecuencialID.substring(0, 4);
        var IdProducto = SecuencialID.substring(4, 10);

        var datos = {
            SecuencialID: SecuencialID,
            IdTransaccionSession: $("#IdTransaccionSession").val()
        }
        $.ajax({
            type: 'POST',
            data: JSON.stringify(datos),
            url: '@Url.Action("AgregarPedido", "FacturaPuntoVenta", new { Area = "Facturacion"})',
            async: false,
            bDeferRender: true,
            bProcessing: true,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $("#Subtotal").html(data.subtotal);
                $("#Iva").html(data.iva);
                $("#Total").html(data.total);
                GridViewPartial_Pedido.PerformCallback();
            },
            error: function (error) {
            }
        });
    }

    function Cliente() {
        $("#link_factura").hide();
        $("#link_cliente").show();
        $("#link_cliente").click();
    }
</script>

<div class="modal fade" id="modal-default-Cantidad" role="dialog">
    <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modificar</h4>
                @Html.HiddenFor(q => q.SecuenciaModificar, new { @id = "SecuenciaModificar" })
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="Cantidad">Cantidad</label>
                                @Html.TextBoxFor(q => q.IdCaja, new { @class = "form-control", @readonly = "readonly", @id="CantidadItem" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="text-align:center">
                    <div class="col-md-12">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('1');" style="width:auto">1</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('2');" style="width:auto">2</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('3');" style="width:auto">3</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('4');" style="width:auto">4</button>                                   
                                </div>
                                <div class="btn-group">                                    
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('5');" style="width:auto">5</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('6');" style="width:auto">6</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('7');" style="width:auto">7</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('8');" style="width:auto">8</button>
                                </div>
                                <div class="btn-group">                                    
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('9');" style="width:auto">9</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('0');" style="width:auto">0</button>
                                    <button type="button" class="btn btn-default" onclick="EscribirCantidad('.');" style="width:auto">&nbsp;.</button>  
                                    <button type="button" title="Borrar" class="btn btn-danger" onclick="Borrar();" style="width:auto; padding:6px 7px"><i class="fa fa-fw fa-remove"></i></button>                                  
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="ModificarCantidad();">Ok</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
            </div>
        </div>

    </div>
</div>

<div id="Tabs" role="tabpanel">
    <ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#tab_factura" aria-controls="factura" role="tab" data-toggle="tab" id="link_factura">Factura</a>
        </li>
        <li hidden>
            <a href="#tab_cliente" aria-controls="cliente" role="tab" data-toggle="tab" id="link_cliente">Cliente</a>
        </li>
    </ul>
    <div class="tab-content" style="padding-top: 20px">
        <div role="tabpanel" class="tab-pane active" style="margin-left: 1em;" id="tab_factura">
            <div class="row">
                <div class="col-md-5">
                    <div class="box box-info">
                        <div class="box-header with-border">
                            <h3 class="box-title">Pedido</h3>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="IdCliente"></label>
                                        @Html.Action("GridViewPartial_Pedido")
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-10">
                                    <div class="form-group" style="text-align:right">
                                        <label>Subtotal</label>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label id="Subtotal">0.00</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-10">
                                    <div class="form-group" style="text-align:right">
                                        <label>IVA</label>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label id="Iva">0.00</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-10">
                                    <div class="form-group" style="text-align:right">
                                        <label>Total</label>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label id="Total">0.00</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="box box-success">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="IdCliente"></label>
                                        <button type="button" class="btn btn-default form-control" title="Familia de productos" id="RegresarFamilia" onclick="Regresar();">
                                            <i class="fa fa-chevron-left">&nbsp;</i> Regresar
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-9">
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div id="DivFamilia">
                                            <div class="box-header with-border">
                                                <h3 class="box-title">Familia de productos</h3>
                                            </div>
                                            @Html.Action("GridViewPartial_Familia")
                                        </div>
                                        <div id="DivProducto" hidden>
                                            <div class="box-header with-border">
                                                <h3 class="box-title">Productos</h3>
                                            </div>
                                            @Html.Action("GridViewPartial_Producto")
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12"> 
                                <div class="col-md-9">
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="IdCliente"></label>
                                        <button type="button" class="btn btn-default form-control" title="Cliente" onclick="Cliente();">
                                            Cliente &nbsp;<i class="fa fa-chevron-right"></i> 
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" style="margin-left: 1em;" id="tab_cliente">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>&nbsp;</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="IdCliente"></label>
                            <button type="button" class="btn btn-default form-control" title="Regresar a Factura" onclick="RegresarCliente();">
                                Cliente &nbsp;<i class="fa fa-chevron-left"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="IdCliente"></label>
                            <button type="button" class="btn btn-success form-control" title="Ver detalle de factura" onclick="Pagar();">
                                Cliente &nbsp;<i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


